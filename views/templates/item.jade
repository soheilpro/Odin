include menu
include itemCard

div
  div.ui.segment
    +menu

  div.ui.basic.segment
    div.ui.grid
      div.eight.wide.column
          a.ui.big.label(href='#/projects/{{ item.project.id }}') {{ item.project.name }}
          h1.ui.header
            div.ui.black.empty.big.circular.label(style='margin-right: 10px; background-color: {{ item.state.color }} !important')
            | {{ item.title }}
          div.tags(ng-if='item.tags.length')
            span.ui.label(ng-repeat='tag in item.tags') {{ tag }}
            br
            br
            br
          div.description(ng-if='item.description')
            span(style='white-space: pre') {{ item.description }}
            br
            br
          ul.links
            li(ng-repeat='link in item.links')
              a(href='{{ link.url }}') {{ link.url }}
            br
          div.assignedUsers(ng-if='item.assignedUsers.length')
            div.right.floated.author(ng-repeat='assignedUser in item.assignedUsers')
              a(href='#/users/{{ assignedUser.id }}')
                img.ui.avatar.image(ng-src='/api/users/{{ assignedUser.id }}/avatar' ng-attr-data-title='{{ assignedUser.name }}' semantic-popup)
            br
            br
          div(ng-if='item.prerequisiteItems.length')
            div.ui.tiny.header Prerequisites:
            script(type='text/ng-template', id='prerequisite_item_template.html').
              <div style="margin-left: 10px; margin-right: 5px; background-color: {{ prerequisiteItem.state.color }} !important" ng-attr-data-title="{{ prerequisiteItem.state.title }}" semantic-popup="semantic-popup" class="ui black empty circular label"></div><a href="#/items/{{ prerequisiteItem.id }}" style="color: #444">{{ prerequisiteItem.project.name }} &mdash; {{ prerequisiteItem.title }}</a>
                <div style='margin-top: 5px; margin-left: 15px' ng-repeat='prerequisiteItem in prerequisiteItem.prerequisiteItems' ng-include="'prerequisite_item_template.html'"></div>
            div(style='margin-top: 5px;' ng-repeat='prerequisiteItem in item.prerequisiteItems' ng-include="'prerequisite_item_template.html'")
      div.eight.wide.right.aligned.column
        a.ui.button(href='#/items/{{ item.id }}/edit')
          i.pencil.icon
          | Edit
        br
        br
        div.ui.selection.dropdown(semantic-dropdown ng-model='item.state.id')
          input(type='hidden')
          div.default.text &nbsp;
          i.dropdown.icon
          div.menu
            div.item(ng-repeat='state in states' ng-attr-data-value='{{ state.id }}' ng-click='item.state = state; saveItemState(item);')
              div.ui.black.empty.circular.label(style='margin-left: 10px; margin-right: 5px; background-color: {{ state.color }} !important')
              | {{ state.title }}
        br
        br
        div.ui.selection.dropdown(semantic-dropdown ng-model='item.assignedUser.id' ng-class='{disabled: isSaving}')
          input(type='hidden')
          div.default.text &nbsp;
          i.dropdown.icon
          div.menu
            div.item(data-value='' ng-click='item.assignedUser = null; saveAssignedUser();') None
            div.item(ng-repeat='user in users' ng-attr-data-value='{{ user.id }}' ng-click='item.assignedUser = user; saveAssignedUser();')
              img.ui.mini.avatar.image(ng-src='/api/users/{{ user.id }}/avatar')
              | {{ user.name }}
  div.ui.basic.segment
    div.ui.grid
      div.right.aligned.column
        div.ui.top.right.pointing.dropdown.icon.labeled.button(semantic-dropdown style='float: right')
          i.tag.icon
          span.text No Filter
          div.menu
            div.item(ng-click='tagFilter = null') No Filter
            div.divider
            div.item(ng-repeat='tag in items | tags' ng-click='$parent.tagFilter = tag') {{ tag }}
    div.ui.grid
      div.four.wide.column(ng-repeat='state in states')
        span.ui.black.empty.circular.label(style='margin-left: 10px; margin-right: 5px; background-color: {{ state.color }} !important')
        span.ui.header {{ state.title }}
        div.ui.divider
        div(style='margin-bottom: 20px' ng-repeat='item in items | tag: tagFilter | state: state')
          +itemCard(item, true)
        form(ng-submit='addSubItem(newSubItem.title, state); newSubItem.title = null;')
          div.ui.left.icon.input
            input(type='text' id='title' placeholder='Add new item...' style='width: 290px' ng-model='newSubItem.title')
            i.add.icon
